<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml"
      th:replace="layout/layout :: layout(~{::section}, 'Lista de Películas')">

<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">

        <!-- Formulario para crear nueva película -->
        <form th:action="@{/movies/save}" th:object="${newMovie}" method="post" class="mb-5">
            <div class="input-group">
                <input type="text" th:field="*{title}" placeholder="Título de la película. EJEMPLO: inception" class="form-control" required/>
                <button type="submit" class="btn btn-primary">Agregar</button>
            </div>
        </form>

        <!-- Lista de películas -->
        <div class="row row-cols-1 row-cols-md-3 row-cols-xl-4 g-4">
            <div th:each="movie : ${movies}" class="col">
                <div class="card h-100 shadow-sm">
                    <!-- Poster de la película -->
                    <img th:src="${movie.posterUrl}" class="card-img-top" alt="Poster"/>

                    <!-- Información de la película -->
                    <div class="card-body text-center">
                        <h5 th:text="${movie.title}" class="fw-bolder"></h5>
                        <p class="mb-1">Director: <span th:text="${movie.director}"></span></p>
                        <p class="mb-1">Año: <span th:text="${movie.estreno}"></span></p>
                        <p class="mb-0">Género: <span th:text="${movie.genre}"></span></p>
                    </div>

                    <!-- Botones de acción -->
                    <div class="card-footer text-center d-flex justify-content-around">
                        <button class="btn btn-sm btn-warning"
                                data-bs-toggle="modal"
                                data-bs-target="#editModal"
                                th:attr="data-id=${movie.idMovie},
                                         data-title=${movie.title},
                                         data-director=${movie.director},
                                         data-year=${movie.estreno},
                                         data-genre=${movie.genre}">
                            Editar
                        </button>

                        <a th:href="@{'/movies/delete/' + ${movie.idMovie}}"
                           class="btn btn-sm btn-danger"
                           onclick="return confirm('¿Seguro que deseas eliminar esta película?');">
                            Eliminar
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para editar película -->
        <div class="modal fade" id="editModal" tabindex="-1">
            <div class="modal-dialog">
                <form th:action="@{/movies/update}" method="post" class="modal-content" th:object="${newMovie}">
                    <div class="modal-header">
                        <h5 class="modal-title">Editar Película</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" th:field="*{idMovie}" id="edit-idMovie"/>
                        <div class="mb-3">
                            <label>Título</label>
                            <input type="text" th:field="*{title}" id="edit-title" class="form-control" required/>
                        </div>
                        <div class="mb-3">
                            <label>Director</label>
                            <input type="text" th:field="*{director}" id="edit-director" class="form-control" required/>
                        </div>
                        <div class="mb-3">
                            <label>Año</label>
                            <input type="number" th:field="*{estreno}" id="edit-year" class="form-control" required/>
                        </div>
                        <div class="mb-3">
                            <label>Género</label>
                            <input type="text" th:field="*{genre}" id="edit-genre" class="form-control" required/>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Guardar cambios</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script para llenar el modal -->
    <script>
        var editModal = document.getElementById('editModal');
        editModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            document.getElementById('edit-idMovie').value = button.getAttribute('data-id');
            document.getElementById('edit-title').value = button.getAttribute('data-title');
            document.getElementById('edit-director').value = button.getAttribute('data-director');
            document.getElementById('edit-year').value = button.getAttribute('data-year');
            document.getElementById('edit-genre').value = button.getAttribute('data-genre');
        });
    </script>
</section>
